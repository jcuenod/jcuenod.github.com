<html>
<head>
<title>Psalms Overview</title>
<link rel="icon" type="image/png" href="./lab_icon.png" />
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
<style type="text/css">
.block, .placeholder {
	display: inline-block;
	width: 25px;
	height: 25px;
	background: #ddedff;
	margin: 2px;
	overflow: hidden;
	text-align: center;
	color: #aaf;
	padding-top: 3px;
	box-sizing: border-box;
}
.block:hover, .block.highlight {
	background: #e43;
	color: #fff;
	cursor: pointer;
}
.clear {
	clear: both;
}
#psalmContainer {
	position: absolute;
	left: 200px;
	top: 50px;
}
#dataContainer {
	position: absolute;
	left: 600px;
	top: 50px;
	overflow: auto;
	bottom: 50px;
}
#dataContainer .heading {
	font-family: sans-serif;
	border-bottom: 1px solid black;
}
.data {
	margin: 5px;
	text-transform: uppercase;
	font-family: sans;
	font-weight: bold;
	font-size: 10px;
	cursor: pointer;
	color: #999;
}
.data:hover, .data.highlight {
	color: #d00;
}
</style>
</head>
<body>
	<div id="psalmContainer"></div>
	<div id="dataContainer"></div>
	<div class="clear"></div>
	<div class="block"></div>
	<script language="javascript">

		const getPsalmBlock = (i) => {
			return $(".block")[i - 1]
		}

		$(() => {
			const psalmContainer = $("#psalmContainer")
			const b = $(".block").clone()
			$(".block").detach()
			const c = $(".clear").clone()
			$(".clear").detach()
			const p = b.clone().attr("class", "placeholder").css("background", "#eee")

			const drawBlockRow = (number, block) => {
				for (let i = 0; i < number; i++)
				{
					$("#psalmContainer").append(block.clone())
				}
			}
			const drawBlockBlock = (number, indent) => {
				let i = 0
				while (i < (number + indent)) {
					$("#psalmContainer").append(i < indent ? p.clone() : b.clone())
					if ((i + 1) % 10 == 0) {
						$("#psalmContainer").append(c.clone())
					}
					i++
				}
				if ((number + indent) % 10 > 0) {
					for (let j = 0; j < 10 - ((number + indent) % 10); j++)
					{
						$("#psalmContainer").append(p.clone())
					}
				}
				$("#psalmContainer").append(c.clone())
			}
			drawBlockBlock(41, 0)
			drawBlockBlock(72-41, 41 % 10)
			drawBlockBlock(89-72, 72 % 10)
			drawBlockBlock(106-89, 89 % 10)
			drawBlockBlock(150-106, 106 % 10)
			$(".block").each((a,b) => {
				$(b).text(a+1)
			})


			const metadata = {
				"for / by": {
					david: [3, 4, 5, 6, 7, 8, 9, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 26, 27, 28, 29, 31, 32, 34, 35, 36, 37, 38, 39, 40, 41, 51, 52, 53, 54, 55, 56, 57, 58, 59, 60, 61, 62, 63, 64, 65, 68, 69, 70, 86, 101, 103, 108, 109, 110, 122, 124, 131, 133, 138, 139, 140, 141, 142, 143, 144, 145],
					asaph: [50, 73, 74, 75, 76, 77, 78, 79, 80, 81, 82, 83],
					ethan: [89],
					juduthun: [39],
					heman: [88],
					moses: [90],
					solomon: [72, 127],
					"sons of korah": [42, 44, 45, 46, 47, 48, 49, 84, 85, 87, 88]
				},
				other: {
					ascents: [120,121,122,123,124,125,126,127,128,129,130,131,132,133,134]
				},

				// ALL THIS DATA IS FROM http://www.crivoice.org/psalmtypes.html
				lament: {
					//89
					"Community lament": [12, 44, 58, 60, 74, 79, 80, 83, 85, 89, 90, 94, 123, 126, 129],
					//27, 36, 52, 89
					"Individual lament":	[3, 4, 5, 7, 9, 10, 13, 14, 17, 22, 25, 26, 27, 28, 31, 36, 39, 40, 41, 42, 43, 52, 53, 54, 55, 56, 57, 59, 61, 64, 70, 71, 77, 86, 89, 120, 139, 141, 142],
					// 32
					"Penitential": [6, 32, 38, 51, 102, 130, 143],
					"Imprecatory Lament": [35, 69, 83, 88, 109, 137, 140]
				},
				thanksgiving: {
					//65,67,136
					"Community": [65, 67, 75, 107, 124, 136],
					//32, 108
					"Individual": [18, 21, 30, 32, 34, 40, 66, 92, 108, 116, 118, 138],
					//8
					"Salvation History": [8, 105, 106, 135, 136],
					//27
					"Songs of Trust": [11, 16, 23, 27, 62, 63, 91, 121, 125, 131],
				},
				"hymn and doxology": {
					//8, 67
					hymn: [8, 19, 33, 66, 67, 95, 100, 103, 104, 111, 113, 114, 117, 145, 146, 147, 148, 149, 150]
				},
				liturgical: {
					// 89
					"Covenant Songs":[50, 78, 81, 89, 132],
					//95
					"Royal / Enthronement":[2, 18, 20, 21, 29, 45, 47, 72, 93, 95, 96, 97, 98, 99, 101, 110, 144],
					"Songs of Zion":[46, 48, 76, 84, 87, 122],
					//68, 95
					"Temple Liturgies":[15, 24, 68, 82, 95, 115, 134],
				},
				community: {
					//1, 36
					"Wisdom Psalms": [1, 36, 37, 49, 73, 112, 127, 128, 133],
					//1
					"Torah Poems": [1, 19, 119],
				}

			}

			const highlightFor = (arr) => {
				arr.forEach(i => {
					$(getPsalmBlock(i)).addClass("highlight")
				})
			}
			unHighlightFor = (arr) => {
				arr.forEach(i => {
					$(getPsalmBlock(i)).removeClass("highlight")
				})
			}

			const mapOfContainers = []
			Object.keys(metadata).forEach(m => {
				$("#dataContainer").append($("<div>").addClass("heading").text(m))
				Object.keys(metadata[m]).forEach(f => {
					const s = $("<div>").addClass("data").text(f).hover(() => {
						highlightFor(metadata[m][f])
					}, () => {
						unHighlightFor(metadata[m][f])
					})
					$("#dataContainer").append(s)
					mapOfContainers.push({
						name: f,
						list: metadata[m][f],
						domNode: s
					})
				})
			})

			const highlightDataPoints = (ps_idx) => {
				mapOfContainers.filter(c => c.list.includes(ps_idx)).forEach(c => {
					c.domNode.addClass("highlight")
				})
			}
			const unHighlightDataPoints = (ps_idx) => {
				mapOfContainers.filter(c => c.list.includes(ps_idx)).forEach(c => {
					c.domNode.removeClass("highlight")
				})
			}
			$(".block").hover((e) => {
				const idx = $(e.target).index(".block") + 1
				highlightDataPoints(idx)
			},(e) => {
				const idx = $(e.target).index(".block") + 1
				unHighlightDataPoints(idx)
			},)
		})

	</script>
</body>
</html>
